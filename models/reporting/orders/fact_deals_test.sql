select
fd.active_po_amount_usd,
fd.active_po_document_number,
fd.auction_create_date,
fd.auction_finished_date,
fd.auction_status,
fd.bdr_owner_id,
fd.bdr_owner_name,
fd.bdr_owner_primary_team_name,
fd.became_customer_date_contact,
date_trunc('day',fd.became_opportunity_date_contact) as became_opportunity_date_contact,
fd.cancellation_reason,
fd.cancelled_at,
fd.change_request_freshdesk_ticket_id,
fd.change_request_status,
fd.city,
fd.closed_date,
fd.closed_deal_days_between_previous_deal_contact,
fd.closed_deal_days_between_previous_deal_from_delivery_contact,
fd.closed_deal_number_contact,
fd.closed_lost_reason,
fd.closed_sales_usd,
fd.company_name,
fd.completed_date,
upper(fd.country_iso2) as country_iso2,
fd.country_name,
fd.cross_dock_city,
fd.cross_dock_country,
fd.customer_success_representative_name,
fd.deal_category,
fd.delay_liability,
fd.delay_status,
fd.delivered_date,
fd.delivered_date_to_cross_dock,
fd.derived_delivery_date,
fd.dispute_created_at,
fd.dispute_liability,
fd.dispute_requested_outcome,
fd.dispute_resolution_date,
fd.dispute_resolution_time_in_hours,
fd.dispute_status,
fd.dispute_type,
fd.document_number,
fd.estimated_delivery_to_cross_dock,
fd.estimated_delivery_to_customer,
fd.first_bdr_owner_date,
fd.first_completed_date,
fd.first_dispute_resolution_type,
fd.first_time_quote_sent_date,
fd.first_time_response_date,
fd.full_delivered_date,
fd.has_auction_manually_reviewed,
fd.has_change_request,
fd.has_consistent_shipping_info,
fd.has_custom_finish,
fd.has_custom_material,
fd.has_first_quote_created_by_admin,
fd.has_manually_reviewed_quote_request,
fd.has_part_without_automatic_pricing,
fd.has_quote_created_by_admin,
fd.high_risk,
fd.hubspot_amount_usd,
fd.hubspot_closedate,
fd.hubspot_company_id,
fd.hubspot_company_source,
fd.hubspot_contact_id,
fd.hubspot_deal_id,
fd.hubspot_dealstage_mapped,
fd.hubspot_dealstage_mapped_sort_index,
fd.hubspot_estimated_close_amount_usd,
fd.hubspot_owner_assigned_date,
fd.hubspot_owner_id,
fd.hubspot_owner_name,
fd.hubspot_owner_primary_team_name,
fd.hubspot_purchasing_manager,
fd.hubspot_sourcing_owner_id,
fd.hubspot_sourcing_owner_name,
fd.hubspot_technical_review_owner,
fd.in_review_reason,
fd.in_review_type,
fd.is_accepted_manually_auction,
fd.is_address_email_from_hubs,
fd.is_closed_won,
fd.is_collected_using_auto_payment,
fd.is_cross_docking,
fd.is_disputed,
fd.is_expedited_shipping,
fd.is_hubspot_strategic_company,
fd.is_hubspot_strategic_deal,
fd.is_instant_payment,
fd.is_new_customer_contact,
fd.is_rda_sourced,
fd.is_recognized,
fd.is_resourced,
fd.is_rfq,
fd.is_shipped_on_time_by_mp,
fd.is_shipped_on_time_to_customer,
fd.is_sourced,
coalesce(fd.is_svp, false) as is_svp,
fd.is_technical_review,
coalesce(fd.is_underquoted, false) as is_underquoted, -- DBT Version has no nulls
fd.last_completed_date,
fd.market,
fd.mechanical_engineer_id,
fd.mechanical_engineer_name,
fd.no_of_packages,
fd.number_of_quote_versions,
fd.number_of_quote_versions_by_admin,
fd.number_of_suppliers_rfq_requests,
fd.number_of_suppliers_rfq_responded,
fd.order_active_po_company_entity,
fd.order_active_po_quote_uuid,
fd.order_active_po_shipping_usd,
orders.created as order_created_at,
fd.order_quote_finalized_date,
fd.order_quote_lead_time,
fd.order_recognized_date,
fd.order_status,
fd.order_technical_review_completed_at,
fd.order_technical_review_submitted_at,
fd.order_uuid,
fd.partner_support_representative_name,
fd.payment_method,
fd.po_first_shipping_usd,
fd.process_id,
fd.process_name,
fd.qc_inspection_result,
fd.quote_company_entity,
date_trunc('day',fd.quote_submitted_date) as quote_submitted_date,
fd.quote_subtotal_amount_usd,
fd.refund_reason,
fd.region,
fd.reorder_original_order_uuid,
fd.requires_local_sourcing,
fd.ship_date_promised_by_supplier,
fd.ship_date_promised_to_customer,
fd.shipped_date,
fd.shipped_date_from_cross_dock,
fd.shipping_by_supplier_days_delay,
fd.shipping_latitude,
fd.shipping_longitude,
fd.shipping_to_customer_days_delay,
fd.shipping_usd,
fd.sourced_cost_usd,
fd.sourced_date,
fd.sourced_sales_usd,
fd.state,
fd.supplier_country_name,
fd.supplier_id,
fd.supplier_latitude,
fd.supplier_longitude,
fd.supplier_name,
fd.technology_id,
fd.technology_name,
fd.winning_bid_uuid,
fd.winning_quote_uuid
from reporting.fact_deals as fd
left join {{ ref('cnc_orders') }} as orders on fd.order_uuid = orders.uuid
where is_legacy_order is not true
and _data_source = 'supply_deals'
