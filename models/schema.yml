version: 2

###########
# SOURCES #
###########

sources:
  - name: adwords
    database: INGESTION_SANDBOX_S3
    schema: adwords
    tables:
      - name: click_performance_reports

  - name: dbt_networkservices
    database: INGESTION_SANDBOX_S3
    schema: dbt_networkservices
    tables:
      - name: gold_auctions
        loaded_at_field: auction_created_at
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_billing_requests
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 31, period: day}
            error_after: {count: 33, period: day}
      - name: gold_bids
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_complaints
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 4, period: day}
            error_after: {count: 7, period: day}
      - name: gold_disputes
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 4, period: day}
            error_after: {count: 7, period: day}
      - name: gold_discount__line_items
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 4, period: day}
            error_after: {count: 7, period: day}
      - name: gold_documents
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_external_orders
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 3, period: day}
      - name: gold_line_items
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_orders
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_order_reviews
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 3, period: day}
      - name: gold_open_questions
        loaded_at_field: submitted_at
        config:
          freshness:
            warn_after: {count: 7, period: day}
            error_after: {count: 14, period: day}
      - name: gold_order_delays
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 4, period: day}
      - name: gold_order_history_events # Used in a sensitive incremental model
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 12, period: hour}
            error_after: {count: 24, period: hour}
      - name: gold_packages
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 12, period: hour}
            error_after: {count: 24, period: hour}
      - name: gold_part_feature_questions
        loaded_at_field: submitted_at
        config:
          freshness:
            warn_after: {count: 7, period: day}
            error_after: {count: 14, period: day}
      - name: gold_quick_link
        loaded_at_field: updated_at
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_quicklinks_tracking
        loaded_at_field: created_at
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: gold_questions
        loaded_at_field: submitted_at
        config:
          freshness:
            warn_after: {count: 7, period: day}
            error_after: {count: 14, period: day}
      - name: gold_supplier_auctions
        loaded_at_field: assigned_at
        config:
          freshness:
            warn_after: {count: 12, period: hour}
            error_after: {count: 24, period: hour}
      - name: gold_shipments
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 12, period: hour}
            error_after: {count: 24, period: hour}
      - name: gold_team_invites
        loaded_at_field: invite_created_at
        config:
          freshness:
            warn_after: {count: 3, period: day}
            error_after: {count: 5, period: day}
      - name: gold_transactions
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 4, period: day}
      - name: gold_users
        loaded_at_field: created_at

        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 3, period: day}
  - name: int_analytics
    database: INGESTION_SANDBOX_S3
    schema: int_analytics
    tables:
      - name: btyd
        loaded_at_field: snapshot_date
        config:
          freshness:
            warn_after: {count: 7, period: day}
            error_after: {count: 14, period: day}
      - name: customer_tiering
        loaded_at_field: snapshot_at
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: delay_probability_v2
        loaded_at_field: model_executed_at
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: mql_conversion_pred
        loaded_at_field: model_executed_at
        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 3, period: day}
      - name: smart_qc
        loaded_at_field: model_executed_at
        config:
          freshness:
            warn_after: {count: 1, period: day}
            error_after: {count: 2, period: day}
      - name: smart_qc_unique_history
        loaded_at_field: model_executed_at
        config:
          freshness:
            warn_after: {count: 2, period: day}
            error_after: {count: 3, period: day}
      - name: dim_dates
      - name: full_order_history_events
        loaded_at_field: created
        config:
          freshness:
            warn_after:
              count: 1
              period: day
            error_after:
              count: 2
              period: day
      - name: legacy_contacts
      - name: legacy_mqls
      - name: legacy_orders
      - name: supply_cross_docking_tracking_details_20200911
      - name: nps_scores
      - name: static_seo_page_group
      - name: static_seo_targets
      - name: supply_countries_markets_mapping

    config:
      tags: ["int_analytics"]
  - name: ext_google_search
    database: INGESTION_SANDBOX_S3
    schema: ext_google_search
    tables:
      - name: search_console
        loaded_at_field: "date::timestamp"

        config:
          freshness:
            warn_after: {count: 5, period: day}
            error_after: {count: 6, period: day}
  - name: dbt_backups
    database: INGESTION_SANDBOX_S3
    schema: dbt_backups
    tables:
      - name: backup_fact_contribution_margin
      - name: backup_fact_orders
      - name: backup_full_order_history_events
      - name: backup_dim_companies
      - name: backup_dim_contacts

  - name: ext_adwords
    database: INGESTION_SANDBOX_S3
    schema: ext_adwords
    tables:
      - name: accounts
      - name: ad_groups
      - name: campaign_performance_report
      - name: campaigns
      - name: click_performance_report
      - name: keywords_performance_report

  - name: ext_aftership_bv
    database: INGESTION_SANDBOX_S3
    schema: ext_aftership_bv
    loaded_at_field: _sdc_received_at
    tables:
      - name: data
      - name: data__msg__checkpoints

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  - name: ext_aftership_llc
    database: INGESTION_SANDBOX_S3
    schema: ext_aftership_llc
    loaded_at_field: _sdc_received_at
    tables:
      - name: data
      - name: data__msg__checkpoints

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  - name: ext_bing
    database: INGESTION_SANDBOX_S3
    schema: ext_bing
    loaded_at_field: _sdc_received_at
    tables:
      - name: accounts
      - name: ad_groups
      - name: campaign_performance_report
      - name: campaigns
      - name: keyword_performance_report

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  - name: ext_bing_emea
    database: INGESTION_SANDBOX_S3
    schema: ext_bing_emea
    loaded_at_field: _sdc_received_at
    tables:
      - name: accounts
      - name: ad_groups
      - name: campaign_performance_report
      - name: campaigns
      - name: keyword_performance_report

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  
  # todo-migration: this source is not available yet, add when ready
  # - name: _ext_bing_factory
  #   loaded_at_field: _sdc_received_at
  #   tables:
  #     - name: accounts
  #     - name: ad_groups
  #     - name: campaign_performance_report
  #     - name: campaigns
  #     - name: keyword_performance_report

    # config:
    #   freshness:
    #     warn_after: {count: 12, period: hour}
    #     error_after: {count: 24, period: hour}

  - name: ext_hubspot_webhooks
    database: INGESTION_SANDBOX_S3
    schema: ext_hubspot_webhooks
    loaded_at_field: _sdc_received_at
    tables:
      - name: data

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  - name: ext_google_ads_console
    database: INGESTION_SANDBOX_S3
    schema: ext_google_ads_console
    loaded_at_field: _sdc_received_at
    tables:
      - name: accounts
      - name: ad_groups
      - name: campaign_performance_report
      - name: campaigns
      - name: click_performance_report
      - name: keywords_performance_report

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  - name: ext_gsheets_v2
    database: INGESTION_SANDBOX_S3
    schema: ext_gsheets_v2
    loaded_at_field: _sdc_received_at
    tables:
      - name: marketing_ahrefs
      - name: marketing_share_of_voice
      - name: marketing_youtube
      - name: hr_bamboo_employees
      - name: sdr_commissions

  - name: ext_hubspot
    database: INGESTION_SANDBOX_S3
    schema: ext_hubspot
    tables:
      - name: contacts
        loaded_at_field: _sdc_received_at
        config:
          freshness:
            warn_after: {count: 24, period: hour}
            error_after: {count: 48, period: hour}
      - name: companies
        loaded_at_field: _sdc_received_at
        config:
          freshness:
            warn_after: {count: 24, period: hour}
            error_after: {count: 48, period: hour}
      - name: hubspot_engagements
        loaded_at_field: load_timestamp
        config:
          freshness:
            warn_after: {count: 24, period: hour}
            error_after: {count: 48, period: hour}
      - name: campaigns
      - name: deals
        loaded_at_field: _sdc_received_at
        config:
          freshness:
            warn_after: {count: 24, period: hour}
            error_after: {count: 48, period: hour}
      - name: deals__associations__associatedcompanyids
      - name: deals__associations__associatedvids
      - name: hubspot_deals_dealstage_history_20201125
      - name: email_events
        loaded_at_field: _sdc_received_at
        config:
          freshness:
            warn_after: {count: 24, period: hour}
            error_after: {count: 48, period: hour}
      - name: hubspot_owners
        loaded_at_field: "load_timestamp"

        config:
          freshness:
            warn_after: {count: 24, period: hour}
            error_after: {count: 48, period: hour}
  - name: ext_netsuite
    database: INGESTION_SANDBOX_S3
    schema: ext_netsuite
    loaded_at_field: _sdc_received_at
    tables:
      - name: currencyrate
      - name: transaction
      - name: customer
      - name: transaction__itemlist__item

    config:
      freshness:
        warn_after: {count: 12, period: hour}
        error_after: {count: 24, period: hour}
  - name: fed_model_repo
    database: INGESTION_SANDBOX_S3
    schema: fed_model_repo
    tables:
      - name: upload

  - name: int_airbyte_controlhub
    database: INGESTION_SANDBOX_S3
    schema: int_airbyte_controlhub
    tables:
      - name: package_scans
      - name: package_messages

  - name: int_greenhubs
    database: INGESTION_SANDBOX_S3
    schema: int_greenhubs
    tables:
      - name: co2_emissions

  - name: int_logistics
    database: INGESTION_SANDBOX_S3
    schema: int_logistics
    tables:
      - name: automated_shipping_customs_information

  - name: int_model_repo_raw
    database: INGESTION_SANDBOX_S3
    schema: int_model_repo_raw
    tables:
      - name: job_ml_geo
      - name: job_machining_quote

  - name: int_retool
    database: INGESTION_SANDBOX_S3
    schema: int_retool
    tables:
      - name: qc_inspections
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: inspection_line_items
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: dhl_api_documents
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: ups_api_documents
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: dhl_api_shipment_dimensions
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: ups_api_shipment_dimensions
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: uk_ups_api_documents
        loaded_at_field: _sdc_batched_at
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: xdock_holdrack_status


  - name: int_service_supply
    database: INGESTION_SANDBOX_S3
    schema: int_service_supply
    tables:
      - name: countries # Required for a snapshot
      - name: cnc_order_quotes # Required for a snapshot
        loaded_at_field: created
        config:
          freshness:
            warn_after: {count: 12, period: hour}
            error_after: {count: 24, period: hour}
      - name: new_bids # Required for a snapshot
      - name: suppliers # Required for a snapshot
      - name: supplier_users # Required for a snapshot

  - name: dbt_ingestion
    database: INGESTION_SANDBOX_S3
    schema: dbt_ingestion
    tables:
      - name: gold_ext_airbyte_exchange_rate_daily
        loaded_at_field: date
        config:
          freshness:
            error_after: {count: 24, period: hour}
      - name: gold_ext_airbyte_hubspot_pages
        loaded_at_field: date
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: gold_ext_airbyte_freshdesk_tickets
        loaded_at_field: _load_timestamp
        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
      - name: gold_ext_airbyte_freshdesk_survey_results
        loaded_at_field: load_timestamp

        config:
          freshness:
            warn_after: {count: 48, period: hour}
            error_after: {count: 72, period: hour}
  - name: ext_freshdesk
    database: INGESTION_SANDBOX_S3
    schema: ext_freshdesk
    loaded_at_field: load_timestamp
    tables:
      - name: freshdesk_ticket_conversations
      - name: freshdesk_tickets_groups_backup_20200401
        config:
          freshness:
      - name: freshdesk_groups_legacy_20200401
        config:
          freshness:
    config:
      freshness:
        warn_after: {count: 24, period: hour}
        error_after: {count: 48, period: hour}
models:
  - name: dim_companies
    columns:
      - name: hubspot_company_id
        tests:
          - unique
  - name: dim_contacts
    columns:
      - name: hubspot_contact_id
        tests:
          - unique
  - name: fact_auction_behaviour
    columns:
      - name: sa_uuid
        tests:
          - unique
          - not_null
  - name: fact_line_items
    columns:
      - name: line_item_uuid
        tests:
          - unique
  - name: fact_orders
    columns:
      - name: order_uuid
        tests:
          - unique